<!doctype html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>L'Evènementiel La Radio</title>
		<link
			rel="stylesheet"
			type="text/css"
			href="https://manager11.streamradio.fr:1420/media/static/css/current_track_widget/status_widget.css"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: Georgia, "Times New Roman", serif;
				min-height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
			}

			.widget-container {
				min-width: 400px;
				max-width: 600px;
				width: 100%;
				background: #dadada;
				border-radius: 24px;
				overflow: hidden;
				position: relative;
			}

			.widget-header {
				background: #7a0000;
				padding: 24px;
				text-align: center;
				position: relative;
				overflow: hidden;
			}

			.widget-header::before {
				content: "";
				position: absolute;
				top: -50%;
				left: -50%;
				width: 200%;
				height: 200%;
				background: #c40000;
				animation: pulse 4s ease-in-out infinite;
			}

			@keyframes pulse {
				0%,
				100% {
					transform: scale(1);
					opacity: 0.5;
				}
				50% {
					transform: scale(1.1);
					opacity: 0.8;
				}
			}

			.widget-header h2 {
				font-family: Georgia, serif;
				font-size: 26px;
				font-weight: bold;
				color: #ffffff;
				text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
				position: relative;
				z-index: 1;
				letter-spacing: 0.5px;
			}

			.widget-body {
				padding: 20px;
			}

			.sc-status-widget {
				position: relative;
			}

			.sc-status-widget * {
				font-family: "Georgia", serif !important;
				font-size: 17px !important;
				color: white !important;
				background-color: #a10000;
				border-radius: 15px;
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
			}

			/* Style personnalisé pour le widget */
			.sc-status-widget [is="stream-status-widget"] {
				font-family: Georgia, serif !important;
			}

			/* Amélioration de la barre de progression */
			.progress-bar-container {
				margin: 20px 0;
				border-radius: 12px;
				overflow: hidden;
				box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			/* Style pour les métadonnées */
			.meta-info {
				background: #f8f9fa;
				padding: 16px;
				border-radius: 12px;
				margin: 16px 0;
				border-left: 4px solid #486bcd;
			}

			.track-image-container {
				display: flex;
				justify-content: center;
				margin-bottom: 20px;
			}

			.track-image-container img {
				border-radius: 16px;
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
				transition: transform 0.3s ease;
			}

			.track-image-container img:hover {
				transform: scale(1.05);
			}

			/* Animation pour le widget */
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.widget-container {
				animation: fadeIn 0.6s ease-out;
			}

			/* Badge de statut en direct */
			.widget-header {
				display: flex;
				flex-direction: column;
				align-items: center;
				background: #7a0000;
				padding: 24px;
				text-align: center;
				position: relative;
				overflow: hidden;
			}

			.live-badge {
				position: relative;
				display: inline-flex;
				align-items: center;
				justify-content: center;
				background: #fa0000;
				color: white;
				padding: 6px 12px;
				border-radius: 14px;
				font-family: Georgia, serif;
				font-size: 12px;
				font-weight: bold;
				box-shadow: 0 4px 8px rgba(255, 71, 87, 0.15);
				margin-top: 10px;
			}

			.live-badge::before {
				content: "";
				width: 8px;
				height: 8px;
				background: white;
				border-radius: 50%;
				margin-right: 6px;
				animation: blink 1.5s infinite;
			}

			@keyframes blink {
				0%,
				100% {
					opacity: 1;
				}
				50% {
					opacity: 0.3;
				}
			}

			/* Sélecteur de station */
			.station-selector {
				margin-bottom: 20px;
				text-align: center;
			}

			.station-selector label {
				display: block;
				font-family: Georgia, serif;
				font-size: 16px;
				font-weight: bold;
				color: #2d3436;
				margin-bottom: 12px;
			}

			.station-buttons {
				display: flex;
				gap: 8px;
				justify-content: center;
				margin-bottom: 16px;
			}

			.station-btn {
				flex: 1;
				padding: 8px 16px;
				border: 2px solid #7a0000;
				background: #ffffff;
				color: #7a0000;
				border-radius: 8px;
				font-family: Georgia, serif;
				font-size: 14px;
				font-weight: bold;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.station-btn:hover {
				background: #7a0000;
				color: #ffffff;
			}

			.station-btn.active {
				background: #7a0000;
				color: #ffffff;
			}

			/* Bouton Play/Stop */
			.play-controls {
				text-align: center;
				margin: 20px 0;
			}

			#playButton {
				background: linear-gradient(135deg, #7a0000 0%, #a10000 100%);
				color: white;
				border: 3px solid #ffffff;
				padding: 15px 30px;
				margin-bottom: -20px;
				font-size: 18px;
				font-weight: bold;
				border-radius: 50px;
				cursor: pointer;
				box-shadow:
					0 6px 15px rgba(122, 0, 0, 0.4),
					0 0 20px rgba(122, 0, 0, 0.2);
				transition: all 0.3s ease;
				position: relative;
				overflow: hidden;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			#playButton:hover {
				transform: scale(1.05);
				box-shadow:
					0 8px 20px rgba(122, 0, 0, 0.6),
					0 0 30px rgba(122, 0, 0, 0.4);
			}

			#playButton.playing {
				background: linear-gradient(135deg, #c40000 0%, #ff0000 100%);
				box-shadow:
					0 6px 15px rgba(196, 0, 0, 0.6),
					0 0 30px rgba(196, 0, 0, 0.4);
			}

			/* Footer décoratif */
			.widget-footer {
				padding: 16px 28px;
				background: #f8f9fa;
				border-top: 1px solid #e9ecef;
				text-align: center;
				font-family: Georgia, serif;
				font-size: 13px;
				color: #6c757d;
			}

			/* Responsive */
			@media (max-width: 480px) {
				.widget-container {
					max-width: 100%;
					border-radius: 16px;
				}

				.widget-header h2 {
					font-size: 22px;
				}

				.widget-body {
					padding: 20px;
				}

				.station-buttons {
					flex-direction: column;
				}
			}

			/* Modal de sélection obligatoire */
			.station-modal-overlay {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.6);
				display: flex;
				align-items: center;
				justify-content: center;
				z-index: 9999;
				padding: 20px;
			}

			.station-modal {
				background: #fff;
				padding: 20px;
				border-radius: 12px;
				max-width: 420px;
				width: 100%;
				text-align: center;
			}

			.station-modal h3 {
				margin-bottom: 12px;
				font-family: Georgia, serif;
			}

			.station-modal .modal-buttons {
				display: flex;
				gap: 8px;
				justify-content: center;
				margin-top: 12px;
			}

			.station-modal .modal-btn {
				flex: 1;
				padding: 10px 14px;
				border-radius: 8px;
				border: 2px solid #7a0000;
				background: #fff;
				color: #7a0000;
				font-weight: bold;
				cursor: pointer;
			}

			.station-modal .modal-btn:hover {
				background: #7a0000;
				color: #fff;
			}
		</style>
	</head>
	<body>
		<div class="widget-container">
			<div class="widget-body">
				<!-- Sélecteur de station -->
				<div class="station-selector">
					<label>Choisissez votre station :</label>
					<div class="station-buttons">
						<button
							class="station-btn"
							data-station="corse"
							data-server-id="1"
							data-url="https://manager11.streamradio.fr:1435/stream"
						>
							Corse
						</button>
						<!-- <button
							class="station-btn"
							data-station="cotedazur"
							data-server-id="2"
							data-url="https://manager11.streamradio.fr:1445/stream"
						>
							Côte d'Azur
						</button> -->
					</div>
				</div>

				<div class="sc-status-widget">
					<div
						id="statusWidgetCorse"
						is="stream-status-widget"
						lang="fr"
						api-base="https://manager11.streamradio.fr:1420/api/v2"
						server-id="1"
						bgcolor="#ffffff"
						border="none"
						bgopacity="1"
						bgimage="https://manager11.streamradio.fr:1420/media/widgets/logo_levenementiel.png"
						meta_font_size="15"
						meta_font_style="normal"
						meta_font_color="#2d3436"
						meta_opacity="1"
						progress_bar_color="#486bcd"
						progress_bar_bg_color="#e9ecef"
						progress_bar_height="28"
						progress_opacity="1"
						progress_font_color="#2d3436"
						progress_font_opacity="1"
						track_image_default="https://manager11.streamradio.fr:1420/media/widgets/logo_levenementiel_XxCivjc.png"
						track_image_size="100"
						vote_show="false"
						vote_buttons_color="#486bcd"
						vote_results_font_color_neg="#ff4757"
						vote_results_font_color_pos="#2ecc71"
						vote_results_font_size="14"
					></div>
					<div
						id="statusWidgetCotedazur"
						is="stream-status-widget"
						lang="fr"
						api-base="https://manager11.streamradio.fr:1420/api/v2"
						server-id="2"
						bgcolor="#ffffff"
						border="none"
						bgopacity="1"
						bgimage="https://manager11.streamradio.fr:1420/media/widgets/logo_levenementiel.png"
						meta_font_size="15"
						meta_font_style="normal"
						meta_font_color="#2d3436"
						meta_opacity="1"
						progress_bar_color="#486bcd"
						progress_bar_bg_color="#e9ecef"
						progress_bar_height="28"
						progress_opacity="1"
						progress_font_color="#2d3436"
						progress_font_opacity="1"
						track_image_default="https://manager11.streamradio.fr:1420/media/widgets/logo_levenementiel_XxCivjc.png"
						track_image_size="100"
						vote_show="false"
						vote_buttons_color="#486bcd"
						vote_results_font_color_neg="#ff4757"
						vote_results_font_color_pos="#2ecc71"
						vote_results_font_size="14"
						style="display: none"
					></div>
				</div>

				<!-- Bouton Play/Stop -->
				<div class="play-controls">
					<button id="playButton">
						<i class="fa-solid fa-play" style="margin-right: 8px"></i> PLAY
					</button>
				</div>

				<!-- Audio element caché -->
				<audio id="radioStream" preload="none">
					<source id="streamSource" src="" type="audio/mpeg" />
					Votre navigateur ne supporte pas l'élément audio.
				</audio>
			</div>

			<!-- Modal de sélection obligatoire (masqué par défaut) -->
			<div
				id="stationModalOverlay"
				class="station-modal-overlay"
				style="display: none"
			>
				<div class="station-modal">
					<h3>Veuillez choisir une station</h3>
					<div class="modal-buttons">
						<button
							class="modal-btn"
							data-station="corse"
							data-url="https://manager11.streamradio.fr:1435/stream"
						>
							Corse
						</button>
						<!-- <button
							class="modal-btn"
							data-station="cotedazur"
							data-url="https://manager11.streamradio.fr:1445/stream"
						>
							Côte d'Azur
						</button> -->
					</div>
				</div>
			</div>

			<div class="widget-footer">En direct sur l'Evènementiel</div>
		</div>

		<script
			type="text/javascript"
			src="https://manager11.streamradio.fr:1420/media/static/js/current_track_widget/status_widget.js"
		></script>
		<script>
			// Applique la police Georgia à tous les éléments du widget après son chargement
			document.addEventListener("DOMContentLoaded", function () {
				setTimeout(function () {
					const widgetElements = document.querySelectorAll(
						".sc-status-widget *",
					);
					widgetElements.forEach(function (element) {
						element.style.fontFamily = "Georgia, serif";
					});
				}, 500);

				// Gestion du sélecteur de station
				const stationButtons = document.querySelectorAll(".station-btn");
				const playButton = document.getElementById("playButton");
				const radioStream = document.getElementById("radioStream");
				const streamSource = document.getElementById("streamSource");
				let statusWidgetCorse = document.getElementById("statusWidgetCorse");
				let statusWidgetCotedazur = document.getElementById(
					"statusWidgetCotedazur",
				);
				const statusWidgetCorseTemplate = statusWidgetCorse
					? statusWidgetCorse.outerHTML
					: null;
				const statusWidgetCotedazurTemplate = statusWidgetCotedazur
					? statusWidgetCotedazur.outerHTML
					: null;

				const stationModalOverlay = document.getElementById(
					"stationModalOverlay",
				);
				const stationModalButtons = document.querySelectorAll(
					"#stationModalOverlay .modal-btn",
				);

				let isPlaying = false;
				let currentStation = null;
				let currentStationUrl = null;
				let hasChosenStation = false;
				let pendingPlayAfterChoice = false;

				function stopPlaybackIfNeeded() {
					if (!isPlaying) return;
					radioStream.pause();
					radioStream.currentTime = 0;
					playButton.innerHTML =
						'<i class="fa-solid fa-play" style="margin-right: 8px;"></i> PLAY';
					playButton.classList.remove("playing");
					isPlaying = false;
				}

				function showWidgetForStation(station) {
					if (!statusWidgetCorse || !statusWidgetCotedazur) return;
					if (!station) {
						statusWidgetCorse.style.display = "none";
						statusWidgetCotedazur.style.display = "none";
						return;
					}
					const isCorse = station === "corse";
					statusWidgetCorse.style.display = isCorse ? "" : "none";
					statusWidgetCotedazur.style.display = isCorse ? "none" : "";
				}

				function widgetIsProbablyGone(widgetEl) {
					if (!widgetEl) return true;
					const style = window.getComputedStyle(widgetEl);
					if (style.display === "none" || style.visibility === "hidden")
						return true;
					const rect = widgetEl.getBoundingClientRect();
					return rect.height < 20;
				}

				function recreateWidget(station) {
					const container = document.querySelector(".sc-status-widget");
					if (!container) return;
					const template =
						station === "corse"
							? statusWidgetCorseTemplate
							: statusWidgetCotedazurTemplate;
					if (!template) return;

					const oldEl =
						station === "corse" ? statusWidgetCorse : statusWidgetCotedazur;
					if (!oldEl || !oldEl.parentNode) return;

					const tmp = document.createElement("div");
					tmp.innerHTML = template;
					const freshEl = tmp.firstElementChild;
					if (!freshEl) return;

					oldEl.parentNode.replaceChild(freshEl, oldEl);
					if (station === "corse") {
						statusWidgetCorse = freshEl;
					} else {
						statusWidgetCotedazur = freshEl;
					}
					showWidgetForStation(hasChosenStation ? currentStation : "corse");
				}

				function setStation(station, stationUrl) {
					if (!station) return;
					currentStation = station;
					hasChosenStation = true;
					if (stationUrl) currentStationUrl = stationUrl;

					// UI active (si on retrouve le bouton correspondant)
					stationButtons.forEach((btn) => {
						btn.classList.toggle("active", btn.dataset.station === station);
					});

					if (stationUrl) {
						streamSource.setAttribute("src", stationUrl);
						radioStream.load();
					}

					showWidgetForStation(currentStation);
					stopPlaybackIfNeeded();
				}

				function hasStreamSource() {
					const srcAttr = streamSource.getAttribute("src");
					return !!(srcAttr && srcAttr.trim());
				}

				function unloadStream() {
					try {
						radioStream.pause();
					} catch (_) {
						// no-op
					}
					radioStream.currentTime = 0;
					streamSource.removeAttribute("src");
					radioStream.load();
				}

				function openStationModal() {
					if (!stationModalOverlay) return;
					stationModalOverlay.style.display = "flex";
				}

				function closeStationModal() {
					if (!stationModalOverlay) return;
					stationModalOverlay.style.display = "none";
				}

				function resetStream() {
					try {
						radioStream.pause();
						radioStream.currentTime = 0;
						radioStream.removeAttribute("src");
						radioStream.load();
					} catch (e) {
						console.error("Error resetting stream:", e);
					}
				}

				function startPlayback() {
					resetStream(); // Ensure the stream is fully reset before playing
					if (!hasStreamSource() && currentStationUrl) {
						streamSource.setAttribute("src", currentStationUrl);
						radioStream.load();
					}
					if (!hasStreamSource()) return;
					radioStream.play();
					playButton.innerHTML =
						'<i class="fa-solid fa-stop" style="margin-right: 8px;"></i> STOP';
					playButton.classList.add("playing");
					isPlaying = true;
				}

				// Gestion des boutons de sélection de station
				stationButtons.forEach((button) => {
					button.addEventListener("click", function () {
						setStation(this.dataset.station, this.dataset.url);
						startPlayback();
					});
				});

				showWidgetForStation("corse");

				streamSource.removeAttribute("src");

				setInterval(() => {
					const stationToShow = hasChosenStation ? currentStation : "corse";
					showWidgetForStation(stationToShow);
					const targetWidget =
						stationToShow === "corse"
							? statusWidgetCorse
							: statusWidgetCotedazur;
					if (widgetIsProbablyGone(targetWidget)) {
						recreateWidget(stationToShow);
					}
				}, 20000);

				// Gestion du bouton Play/Stop
				playButton.addEventListener("click", function () {
					if (isPlaying) {
						resetStream();
						playButton.innerHTML =
							'<i class="fa-solid fa-play" style="margin-right: 8px;"></i> PLAY';
						playButton.classList.remove("playing");
						isPlaying = false;
					} else {
						if (!hasChosenStation) {
							pendingPlayAfterChoice = true;
							openStationModal();
							return;
						}
						startPlayback();
					}
				});

				// Modal: sélection obligatoire (au premier Play si pas de station)
				stationModalButtons.forEach((button) => {
					button.addEventListener("click", function () {
						const station = this.dataset.station;
						const url = this.dataset.url;
						setStation(station, url);
						closeStationModal();
						if (pendingPlayAfterChoice) {
							pendingPlayAfterChoice = false;
							startPlayback();
						}
					});
				});

				// Gestion de la fin du stream
				radioStream.addEventListener("ended", function () {
					unloadStream();
					playButton.innerHTML =
						'<i class="fa-solid fa-play" style="margin-right: 8px;"></i> PLAY';
					playButton.classList.remove("playing");
					isPlaying = false;
				});

				// Gestion des erreurs
				radioStream.addEventListener("error", function () {
					alert("Erreur lors du chargement du flux radio.");
					unloadStream();
					playButton.innerHTML =
						'<i class="fa-solid fa-play" style="margin-right: 8px;"></i> PLAY';
					playButton.classList.remove("playing");
					isPlaying = false;
				});
			});
		</script>
	</body>
</html>
